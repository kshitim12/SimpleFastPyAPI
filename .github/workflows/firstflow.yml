name: Code Scanning and PR Check

on:
  pull_request:
    branches:
      - '*'

jobs:
  code-scan:
    name: Code Scanning
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Initialize CodeQL
        uses: github/codeql-action/init@v2
        with:
          languages: python  # Replace with the appropriate language(s) for your project
          queries: ./codeql-queries  # Path to your CodeQL queries

      - name: Perform CodeQL Analysis
        uses: github/codeql-action/analyze@v2

      - name: Check for Vulnerabilities
        run: |
          # Run a command to check for vulnerabilities in the SARIF file generated by CodeQL.
          # Replace this command with your specific vulnerability checking logic.
          # If vulnerabilities are found, set a status or return a non-zero exit code.
          # Example:
          if [ -e codeql-results/codeql-results.sarif ]; then
            echo "Checking for vulnerabilities..."
            # Your vulnerability check logic here
          fi
        working-directory: ${{ github.workspace }}

      - name: Prevent Merge on Vulnerabilities
        if: failure()
        run: |
          # Prevent the PR from being merged when vulnerabilities are found.
          # You can adjust this step to match your repository's merging policies.
          # Example: Use GitHub API to prevent merging
          echo "Vulnerabilities found. Merging is disabled."
          # Use GitHub API to prevent merging here
        working-directory: ${{ github.workspace }}

